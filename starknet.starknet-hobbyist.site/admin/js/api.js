var l=layui,$=l.$,form=l.form,table=l.table,upload=l.upload,laydate=l.laydate,element=l.element,laypage=l.laypage,dropdown=l.dropdown,util=l.util,api={init(){let e=this;e.u(e),e.m(e),e.f(e),e.q(e),e.n(e),e.a(e),e.w(),e.t(e),e.c(e)},i(){let e=this;e.tableDel=e.b,e.copy=e.p,e.menu=e.e,e.url=e.r,layui.layer.msg=e.g,e.sort=e.o,e.count=e.c;},d:{c:"click",d:"dblclick"},u(e){e.s(e.d.c,".upload-item",function(){var a=$(this),t=a.attr("cut"),l=a.attr("del"),i=a.attr("ext"),o=a.attr("path"),r=a.children("img").attr("src"),n=$(`<input type='file'accept='${i || "image/*"}'/>`),s="layer-load";if(null!=t)return layer.open({type:2,title:"裁剪图片",area:["700px","600px"],maxmin:!1,content:"cut_picture.php",shade:.3,success:()=>window.cut=a});n.change(function(){var t=$(this)[0].files,i=new FormData;i.append("file",t[0]),i.append("out",r),null!=o&&i.append("path",o),null!=r&&-1==r.indexOf("//")&&i.append("src",r),$.ajax({url:e.r("upload","../?method="),type:"POST",dataType:"json",data:i,processData:!1,contentType:!1,beforeSend:()=>layer.msg(`<span class='${s}'>正在上传</span>`,{icon:16,shade:.05,time:!1}),xhr:()=>{var e=new XMLHttpRequest;return e.upload.addEventListener("progress",e=>$(`${s}`).text("已上传"+(e.loaded/e.total*100).toFixed(2)+"%")),e},success:e=>{if(layer.msg(e.msg,{icon:e.code}),api.success&&api.success(a,e),1==e.code){var t=e.data.host;null!=r&&-1==r.indexOf("//")&&(t=e.data.url),a.html('<img src="'+t+'" />').parents(".layui-form-item").find("input").eq(0).val(e.data.host),null!=l&&a.append("<div class='upload-del'><span class='del-file'>删除</span></div>")}},error:e=>layer.alert(e.responseText,{icon:2})})}),n.click()}),e.s(e.d.c,".upload-del",function(){var a=$(this).parents(".upload-item"),t=a.children("img").attr("src");return-1==t.indexOf("http")?layer.msg("禁止删除图片",{icon:3}):($.ajax({url:e.r("delFile","../?method="),type:"POST",dataType:"json",data:{url:t},success:e=>{layer.msg(e.msg,{icon:e.code}),1==e.code&&a.html("").parents(".layui-form-item").find("input").eq(0).val("")}}),!1)})},s(e,a,t){$(document).on(e,a,t)},m(e){var a=["qq.com","163.com","126.com","sina.com","sohu.com","yahoo.cn","gmail.com","hotmail.com"];$("body").append("<style>.mail-list {background-color: #fff;border: 1px solid #ddd;box-sizing: border-box;padding: 3px 5px 5px;position: absolute;z-index: 9999;-webkit-box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.1);-moz-box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.1);}.mail-list>li {font-size: 14px;height: 33px;line-height: 33px;color: #939393;list-style: none;cursor: pointer;overflow: hidden;padding: 0px 10px;}.mail-list>li:hover {background-color: #F2F2F2;color: #333333;}</style>"),e.s("focus input propertychange",'[lay-type="email"],[type="email"]',function(e){var t=$(this),l=t.outerWidth(),i=$('<div class="mail-list"></div>'),o=$(t).val();if(-1==o.indexOf("@")&&""!=o)for(var r in $(".mail-list").remove(),i.width(l),t.after(i),a)i.append("<li>"+o+"@"+a[r]+"</li>")}),e.s(e.d.c,".mail-list>li",function(){var e=$(this),a=e.text();e.parent().prev().val(a),e.parent().remove()})},c(){var e=$("[lay-count]");e.next(".count").remove(),e.each((a,t)=>{for(var l,i=Number($(t).attr("lay-count")),o=$(t).val(),r=o.length,n=$("[lay-submit]"),s=0;s<r;s++)o.charCodeAt(s)>255&&r++;l=$(`<span class='count'style='color: #c0c4cc;margin-left: 5px;position: absolute;right: 5px;bottom: 5px;background-color: #FFFFFF;'>${r}/${i}</span>`),$(t).after(l),r>i&&(l.css("color","red"),n.prop('disabled', true)),e.off("input propertychange").on("input propertychange",function(){for(var e=$(this),a=e.val(),t=a.length,l=Number(e.attr("lay-count")),i=e.next(),o=0;o<t;o++)a.charCodeAt(o)>255&&t++;i.text(t+"/"+l),t>l?(i.css("color","red"),n.prop('disabled', true)):(i.css("color","#c0c4cc"),n.prop('disabled', false))})})},f(e){var a=$(".layui-input,.layui-textarea");$(l="[lay-copy]").off(),a.attr("autocomplete","off"),e.s(e.d.c,l,function(){let a=$(this).attr("lay-copy");e.copy(a)}),$('[lay-type="date"]').each((e,a)=>{let t=$('<i class="layui-icon layui-icon-date" style="position: absolute;left: 10px;top: 6px;font-size: 16px;color:#999999"></i>'),l=$(a);l.after(t).css("padding-left","35px"),t.click(()=>l.click().focus())}),form.verify({username:[/^\w{3,20}$/,"用户名只能包含数字或者字母"],password:[/^\w{3,20}$/,"密码只能包含数字或者字母"],captcha:[/^[0-9]{4}$/,"验证码只能是4位纯数字"],smscode:[/^[0-9]{6}$/,"验证码只能是6位纯数字"]});a=$('input[type="password"]');var t="lay-password",l="-show",i="-hide";$("."+t).off(e.d.c).remove(),a.after('<span class="lay-password lay-password-show" title="显示密码"></span>'),e.s(e.d.c,"."+t+l,function(){$(this).removeClass(t+l).addClass(t+i).attr("title","隐藏密码"),$(this).prev().attr("type","text")}),e.s(e.d.c,"."+t+i,function(){$(this).removeClass(t+i).addClass(t+l).attr("title","显示密码"),$(this).prev().attr("type","password")}),e.s(e.d.c,"[lay-close]",()=>parent.layer.close(parent.layer.getFrameIndex(window.name)))},g(e,a={},t=!1){var l=a.icon||1,i=a.time?a.time:0!=a.time&&(1==l?2e3:3e3),o="api-msg",r=$(`<div class='api-msg'>${e}</div>`),n=$('[lay-filter="submit"]'),s=parent.$(".layui-tab-item.layui-show>iframe"),d=o+"-";if($("."+o).remove(),$("body").append(r),1==l&&(d+="success"),3==l&&(d+="warning"),5==l&&(d+="error"),16==l&&(d+="load"),r.css({left:0,top:"50px",right:0}).addClass(d),layer.closeAll("dialog"),i&&setTimeout(()=>{r.animate({opacity:.5,top:'-=30px'},800,()=>{if(r.remove(),i&&1==n.length&&n.prop('disabled', false),i&&1==s.length){var e=s[0].contentWindow.window.$("iframe");if(1==e.length)1==e[0].contentWindow.window.$("[lay-filter='submit']").length&&n.prop('disabled', false)}t&&t()})},i),1==n.length&&n.prop('disabled', true),1==s.length){var c=s[0].contentWindow.window.$("iframe");if(1==c.length)1==(n=c[0].contentWindow.window.$('[lay-filter="submit"]')).length&&n.prop('disabled', true)}},b(){var e=$(".layui-laypage-count"),a=e.text(),t=Number(a.replace(/[^0-9]/gi,""));e.text(`共 ${t-1}条`)},p(e,a="复制成功"){if(navigator.clipboard)navigator.clipboard.writeText(e);else{var t=$("<textarea></textarea>");$("body").append(t),t.val(e).select(),document.execCommand("Copy"),t.remove()}a&&layer.msg(a)},q(e){this.s(e.d.d,"input[phpm],textarea[phpm]",function(){parent.window.phpm=$(this),parent.layer.open({type:2,title:"SQL查询",area:["820px","600px"],maxmin:!1,content:"sql.php",shade:.3})})},e(e,a=!1){var t=!1,l=this;l.s("contextmenu",e,function(){return a&&a(this,"contextmenu"),!1}),l.s("touchstart",e,function(){var e=this;t&&clearInterval(t),t=setTimeout(()=>a&&a(e,l.d.c),1e3),$(document).on("touchmove.menu",()=>{t&&clearInterval(t)}),$(document).on("touchend.menu",function(){t&&clearInterval(t),$(this).off("touchmove.menu touchend.menu")})})},n(e){e.s(e.d.c,"[lay-icon]",function(){parent.icon=$(this),parent.layer.open({type:2,title:!1,area:["260px","353px"],maxmin:!1,content:"page/icon.php",shade:.3})})},t(e){e.s("mouseenter","[lay-tips]",function(){var e=$(this).attr("lay-tips");layer.tips(e,this,{tips:[4,"#000000"]})})},r(e,a=!1){var t=location.pathname.split("page/"),l=2==t.length?t[1]:t[0];return a?a+e:l+"?method="+e},a(e){var a=".layui-table-col-special .layui-unselect.layui-form-checkbox",t=!1;this.s(e.d.c,a,function(e){if(e.shiftKey&&t)for(var l=$(a).index(t),i=(e=$(a).index(this))>l?e:l,o=e>l?l:e;o<=i;o++)$(a).eq(o).not(".layui-form-checked").click();t=this})},o(e,a=!1){var t=e.page,l=e.limit;$(".lay-sort").unbind(),new Sortable($("tbody")[0],{handle:".lay-sort",animation:150,ghostClass:"blue-background-class",onEnd:()=>{var e=[];$(".lay-sort").each((a,t)=>e.push({id:$(t).data("id"),indexs:a})),$.ajax({url:api.url("SetSort"),type:"POST",dataType:"json",data:{data:e,page:t,limit:l,surface:a||$("table[lay-filter]").attr("lay-filter")},success:e=>{if(1!=e.code)return layer.msg(e.msg,{icon:e.code});$(".layui-table-body .laytable-cell-numbers").each((e,a)=>$(a).text(e+(t-1)*l+1))},error:e=>layer.alert(e.responseText,{icon:2})})}})},w(){form.on("select(fieldTypeSelect)",e=>{var a=$("[name=fieldTypeInput]").children("div");a.addClass("layui-hide"),""!=e.value&&a.children(`[name=${e.value}]`).parent().removeClass("layui-hide")}),$(".layui-btn.search").click(()=>reload&&reload()),$(".layui-input").keydown(e=>{13==e.keyCode&&(reload&&reload(),$('[lay-filter="submit"]').length>0&&t.click())}),$(".layui-btn.layui-btn-sm.layui-btn-primary.resetting").click(()=>{$("[name=fieldTypeInput]").find(".showSearch").each((e,a)=>$(a).children("*:eq(0)").val("")),reload&&reload()})}};api.i(),window.onload=(()=>api.init()),window.where=(()=>{var e={};return $(".layui-card-body [name]").each((a,t)=>e[$(t).attr("name")]=$(t).val()),e}),window.reload=((e=!1)=>{var a=e||$("table[lay-filter]").attr("lay-filter");layui.table.reload(a,{page:{curr:1},where:where()})});